<!DOCTYPE html>
<html lang="zh-CN"><head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta
        name="viewport"
        content="width=device-width,initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no"
    />
    <meta name="keywords" content="pengjielee,个人博客" />
    <meta name="description" content="Pengjielee的个人博客" />
    <title>Pengjielee&#39;s blog</title>

    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700" />
    <link rel="stylesheet" href="/css/monokai-sublime.min.css" />
    <link rel="stylesheet" href="/css/style.css" />
</head>
<body>
        <div id="main">
            <nav class="nav">
    <a href="/">首页</a> <span class="divide">|</span>
    <a href="/categories">分类</a>
    <span class="divide">|</span> <a href="/tags">标签</a>
    <span class="divide">|</span>
    <a href="/post">归档</a>
</nav>

    <div class="page page-single">
        <header class="header">
            <h1 class="title">Python基础：操作Mongodb</h1><div class="post-meta">
    <div class="date">2020-11-17</div>
        <div class="tags">
            <label class="label">Tags：</label>
                <a class="link" href="/tags/python/" rel="tag">Python</a>
        </div>
</div>
</header>
        <div class="content"><h2 id="查看python版本更新pip">查看python版本/更新pip</h2>
<pre tabindex="0"><code>$ python3 --version
$ pip install --upgrade pip
</code></pre><h2 id="安装">安装</h2>
<pre tabindex="0"><code>pip install pymongo
</code></pre><h2 id="连接mongodb">连接mongodb</h2>
<pre tabindex="0"><code>from pymongo import MongoClient

# 格式化输出
from pprint import pprint

client = MongoClient(&#39;mongodb://localhost:27017/&#39;)

# 指定数据库
db = client.wangyi 

# 指定集合
collection = db.playlist
</code></pre><h2 id="插入">插入</h2>
<pre tabindex="0"><code># 插入单条
result = collection.insert_one({&#39;title&#39;:&#39;test&#39;})
pprint(result)

# 插入多条
result = collection.insert_many([{&#39;title&#39;:&#39;test1&#39;},{&#39;title&#39;:&#39;test2&#39;}])
pprint(result)
</code></pre><h2 id="查询">查询</h2>
<pre tabindex="0"><code># 查询一条
result = collection.find_one({})
pprint(result)

# 查询多条
results = collection.find({})
pprint(results)
for item in results:
	print(item)

# 条件查询
results = collection.find({&#39;age&#39;: {&#39;$lt&#39;: 20}})        #小于20
results = collection.find({&#39;age&#39;: {&#39;$gt&#39;: 20}})        #大于20
results = collection.find({&#39;age&#39;: {&#39;$lte&#39;: 20}})       #小于等于20
results = collection.find({&#39;age&#39;: {&#39;$gte&#39;: 20}})       #大于等于20
results = collection.find({&#39;age&#39;: {&#39;$ne&#39;: 20}})        #不等于20
results = collection.find({&#39;age&#39;: {&#39;$in&#39;: [20,23]}})   #在[20,23]之间
results = collection.find({&#39;age&#39;: {&#39;$nin&#39;: [20,23]}})  #不在[20,23]之间

results = collection.find({&#39;name&#39;: {&#39;$regex&#39;: &#39;^M.*&#39;}}) #名字以M开头
results = collection.find({&#39;name&#39;: {&#39;$exists&#39;: True}})  #name属性存在
results = collection.find({&#39;age&#39;: {&#39;$type&#39;: &#39;int&#39;}}})   #age的类型为int
results = collection.find({&#39;age&#39;: {&#39;$mod&#39;: [5, 0]}})    #age模5余0 
results = collection.find({&#39;$text&#39;: {&#39;$search&#39;: &#39;Mike&#39;}})#text类型的属性中包含Mike字符串
results = collection.find({&#39;$where&#39;: &#39;obj.fans_count == obj.follows_count&#39;})#自身粉丝数等于关注数
</code></pre><h2 id="count">count()</h2>
<pre tabindex="0"><code>count = collection.find().count()
print(count)
</code></pre><h2 id="排序">排序</h2>
<pre tabindex="0"><code># 升序
results = collection.find().sort(&#39;name&#39;, pymongo.ASCENDING)

# 降序
results = collection.find().sort(&#39;name&#39;, pymongo.DESCENDING)
</code></pre><h2 id="分页">分页</h2>
<pre tabindex="0"><code>results = collection.find().skip(10).limit(10)
</code></pre><h2 id="更新">更新</h2>
<pre tabindex="0"><code># 更新一条
condition = {&#39;title&#39;: &#39;test&#39;}
item = collection.find_one(condition)
item[&#39;title&#39;] = &#39;test1&#39;
result = collection.update_one(condition, {&#39;$set&#39;: item})

# 更新多条
condition = {&#39;title&#39;: &#39;test&#39;}
item = collection.find_one(condition)
item[&#39;title&#39;] = &#39;test1&#39;
result = collection.update_many(condition, {&#39;$set&#39;: item})
</code></pre><h2 id="移除">移除</h2>
<pre tabindex="0"><code>result = collection.remove({})
print(result)
</code></pre><h2 id="more">More</h2>
<p>Python操作MongoDB看这一篇就够了<br>
<a href="https://cloud.tencent.com/developer/article/1151814">https://cloud.tencent.com/developer/article/1151814</a></p>
<p>getting started with python and mongodb <br>
<a href="https://www.mongodb.com/blog/post/getting-started-with-python-and-mongodb">https://www.mongodb.com/blog/post/getting-started-with-python-and-mongodb</a></p>
</div>
    </div>

        </div><script src="/js/highlight.min.js" />
<script>
    document.addEventListener("DOMContentLoaded", (event) => {
        document.querySelectorAll("pre").forEach((block) => {
            hljs.highlightBlock(block);
        });
    });
</script>
</body>
</html>
