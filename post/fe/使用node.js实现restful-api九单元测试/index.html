<!DOCTYPE html>
<html lang="zh-CN"><head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta
        name="viewport"
        content="width=device-width,initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no"
    />
    <meta name="keywords" content="pengjielee,个人博客" />
    <meta name="description" content="Pengjielee的个人博客" />
    <title>Pengjielee&#39;s blog</title>

    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700" />
    <link rel="stylesheet" href="/css/monokai-sublime.min.css" />
    <link rel="stylesheet" href="/css/style.css" />
</head>
<body>
        <div id="main">
            <nav class="nav">
    <a href="/">首页</a> <span class="divide">|</span>
    <a href="/categories">分类</a>
    <span class="divide">|</span> <a href="/tags">标签</a>
    <span class="divide">|</span>
    <a href="/post">归档</a>
</nav>

    <div class="page page-single">
        <header class="header">
            <h1 class="title"></h1><div class="post-meta">
    <div class="date">0001-01-01</div>
</div>
</header>
        <div class="content"><p>1、安装依赖</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#a6e22e">npm</span> <span style="color:#a6e22e">install</span> <span style="color:#a6e22e">chai</span> <span style="color:#a6e22e">chai</span><span style="color:#f92672">-</span><span style="color:#a6e22e">http</span> <span style="color:#a6e22e">mocha</span> <span style="color:#a6e22e">nyc</span> <span style="color:#f92672">--</span><span style="color:#a6e22e">save</span><span style="color:#f92672">-</span><span style="color:#a6e22e">dev</span>
</span></span></code></pre></div><p>2、更新package.json</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#e6db74">&#34;scripts&#34;</span><span style="color:#f92672">:</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;test&#34;</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;nyc -a mocha --recursive&#34;</span>,
</span></span><span style="display:flex;"><span>},
</span></span></code></pre></div><p>3、创建test目录</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#a6e22e">mkdir</span> <span style="color:#a6e22e">test</span><span style="color:#f92672">/</span><span style="color:#a6e22e">test</span>.<span style="color:#a6e22e">js</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">目录结构</span><span style="color:#960050;background-color:#1e0010">：</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">/app</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">--</span><span style="color:#960050;background-color:#1e0010">/src</span>
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">--</span><span style="color:#960050;background-color:#1e0010">/test</span>
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">----</span><span style="color:#a6e22e">test</span>.<span style="color:#a6e22e">js</span>	
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">--</span><span style="color:#66d9ef">package</span>.<span style="color:#a6e22e">json</span>
</span></span></code></pre></div><p>4、更新src/server.js</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">express</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">require</span>(<span style="color:#e6db74">&#39;express&#39;</span>);
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">app</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">express</span>();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">app</span>.<span style="color:#a6e22e">get</span>(<span style="color:#e6db74">&#39;/&#39;</span>, (<span style="color:#a6e22e">req</span>, <span style="color:#a6e22e">res</span>) =&gt; {
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">res</span>.<span style="color:#a6e22e">status</span>(<span style="color:#ae81ff">200</span>).<span style="color:#a6e22e">send</span>(<span style="color:#e6db74">&#39;Hello World!&#39;</span>);
</span></span><span style="display:flex;"><span>});
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">app</span>.<span style="color:#a6e22e">get</span>(<span style="color:#e6db74">&#39;/hello&#39;</span>, (<span style="color:#a6e22e">req</span>, <span style="color:#a6e22e">res</span>) =&gt; {
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">res</span>.<span style="color:#a6e22e">status</span>(<span style="color:#ae81ff">200</span>).<span style="color:#a6e22e">send</span>(<span style="color:#e6db74">&#39;Hello World!&#39;</span>);
</span></span><span style="display:flex;"><span>});
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">//404错误处理
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#a6e22e">app</span>.<span style="color:#a6e22e">use</span>(<span style="color:#66d9ef">function</span> (<span style="color:#a6e22e">req</span>, <span style="color:#a6e22e">res</span>, <span style="color:#a6e22e">next</span>) {
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">res</span>.<span style="color:#a6e22e">status</span>(<span style="color:#ae81ff">404</span>).<span style="color:#a6e22e">send</span>(<span style="color:#e6db74">&#39;Not Found&#39;</span>);
</span></span><span style="display:flex;"><span>});
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">module</span>.<span style="color:#a6e22e">exports</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">app</span>.<span style="color:#a6e22e">listen</span>(<span style="color:#a6e22e">port</span>, () =&gt; {
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#e6db74">`My app listening at http://localhost:</span><span style="color:#e6db74">${</span><span style="color:#a6e22e">port</span><span style="color:#e6db74">}</span><span style="color:#e6db74">`</span>);
</span></span><span style="display:flex;"><span>});
</span></span></code></pre></div><p>5、更新test/test.js</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#66d9ef">let</span> <span style="color:#a6e22e">chai</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">require</span>(<span style="color:#e6db74">&#39;chai&#39;</span>);
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">let</span> <span style="color:#a6e22e">chaiHttp</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">require</span>(<span style="color:#e6db74">&#39;chai-http&#39;</span>);
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">let</span> <span style="color:#a6e22e">server</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">require</span>(<span style="color:#e6db74">&#39;../src/server&#39;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">let</span> <span style="color:#a6e22e">should</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">chai</span>.<span style="color:#a6e22e">should</span>();
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">chai</span>.<span style="color:#a6e22e">use</span>(<span style="color:#a6e22e">chaiHttp</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">describe</span>(<span style="color:#e6db74">&#39;Server&#39;</span>, () =&gt; {
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">it</span>(<span style="color:#e6db74">&#39;should respond status 200&#39;</span>, (<span style="color:#a6e22e">done</span>) =&gt; {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">chai</span>
</span></span><span style="display:flex;"><span>      .<span style="color:#a6e22e">request</span>(<span style="color:#a6e22e">server</span>)
</span></span><span style="display:flex;"><span>      .<span style="color:#a6e22e">get</span>(<span style="color:#e6db74">&#39;/&#39;</span>)
</span></span><span style="display:flex;"><span>      .<span style="color:#a6e22e">end</span>((<span style="color:#a6e22e">err</span>, <span style="color:#a6e22e">res</span>) =&gt; {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">res</span>.<span style="color:#a6e22e">should</span>.<span style="color:#a6e22e">have</span>.<span style="color:#a6e22e">status</span>(<span style="color:#ae81ff">200</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">done</span>();
</span></span><span style="display:flex;"><span>      });
</span></span><span style="display:flex;"><span>  });
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">it</span>(<span style="color:#e6db74">&#39;should GET the hello response&#39;</span>, (<span style="color:#a6e22e">done</span>) =&gt; {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">chai</span>
</span></span><span style="display:flex;"><span>      .<span style="color:#a6e22e">request</span>(<span style="color:#a6e22e">server</span>)
</span></span><span style="display:flex;"><span>      .<span style="color:#a6e22e">get</span>(<span style="color:#e6db74">&#39;/hello&#39;</span>)
</span></span><span style="display:flex;"><span>      .<span style="color:#a6e22e">end</span>((<span style="color:#a6e22e">err</span>, <span style="color:#a6e22e">res</span>) =&gt; {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">res</span>.<span style="color:#a6e22e">should</span>.<span style="color:#a6e22e">have</span>.<span style="color:#a6e22e">status</span>(<span style="color:#ae81ff">200</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">res</span>.<span style="color:#a6e22e">text</span>.<span style="color:#a6e22e">should</span>.<span style="color:#a6e22e">equal</span>(<span style="color:#e6db74">&#39;Hello World!&#39;</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">done</span>();
</span></span><span style="display:flex;"><span>      });
</span></span><span style="display:flex;"><span>  });
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">it</span>(<span style="color:#e6db74">&#39;should respond status 404&#39;</span>, (<span style="color:#a6e22e">done</span>) =&gt; {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">chai</span>
</span></span><span style="display:flex;"><span>      .<span style="color:#a6e22e">request</span>(<span style="color:#a6e22e">server</span>)
</span></span><span style="display:flex;"><span>      .<span style="color:#a6e22e">get</span>(<span style="color:#e6db74">&#39;/wrongUrl&#39;</span>)
</span></span><span style="display:flex;"><span>      .<span style="color:#a6e22e">end</span>((<span style="color:#a6e22e">err</span>, <span style="color:#a6e22e">res</span>) =&gt; {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">res</span>.<span style="color:#a6e22e">should</span>.<span style="color:#a6e22e">have</span>.<span style="color:#a6e22e">status</span>(<span style="color:#ae81ff">404</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">res</span>.<span style="color:#a6e22e">text</span>.<span style="color:#a6e22e">should</span>.<span style="color:#a6e22e">equal</span>(<span style="color:#e6db74">&#39;Not Found&#39;</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">done</span>();
</span></span><span style="display:flex;"><span>      });
</span></span><span style="display:flex;"><span>  });
</span></span><span style="display:flex;"><span>});
</span></span></code></pre></div><p>6、运行 npm run test</p>
<p>输出：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#a6e22e">My</span> <span style="color:#a6e22e">app</span> <span style="color:#a6e22e">listening</span> <span style="color:#a6e22e">at</span> <span style="color:#a6e22e">http</span><span style="color:#f92672">:</span><span style="color:#75715e">//localhost:3000
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">Server</span>
</span></span><span style="display:flex;"><span>    <span style="color:#960050;background-color:#1e0010">✔</span> <span style="color:#a6e22e">should</span> <span style="color:#a6e22e">respond</span> <span style="color:#a6e22e">status</span> <span style="color:#ae81ff">200</span>
</span></span><span style="display:flex;"><span>    <span style="color:#960050;background-color:#1e0010">✔</span> <span style="color:#a6e22e">should</span> <span style="color:#a6e22e">GET</span> <span style="color:#a6e22e">the</span> <span style="color:#a6e22e">hello</span> <span style="color:#a6e22e">response</span>
</span></span><span style="display:flex;"><span>    <span style="color:#960050;background-color:#1e0010">✔</span> <span style="color:#a6e22e">should</span> <span style="color:#a6e22e">respond</span> <span style="color:#a6e22e">status</span> <span style="color:#ae81ff">404</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#ae81ff">3</span> <span style="color:#a6e22e">passing</span> (<span style="color:#ae81ff">37</span><span style="color:#a6e22e">ms</span>)
</span></span></code></pre></div><p>7、使用chai对express进行单元测试时报错 TypeError: app.address is not a function</p>
<p>错误信息：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#a6e22e">My</span> <span style="color:#a6e22e">app</span> <span style="color:#a6e22e">listening</span> <span style="color:#a6e22e">at</span> <span style="color:#a6e22e">http</span><span style="color:#f92672">:</span><span style="color:#75715e">//localhost:3000
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">Server</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ae81ff">1</span>) <span style="color:#a6e22e">should</span> <span style="color:#a6e22e">respond</span> <span style="color:#a6e22e">status</span> <span style="color:#ae81ff">200</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ae81ff">2</span>) <span style="color:#a6e22e">should</span> <span style="color:#a6e22e">GET</span> <span style="color:#a6e22e">the</span> <span style="color:#a6e22e">hello</span> <span style="color:#a6e22e">response</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ae81ff">3</span>) <span style="color:#a6e22e">should</span> <span style="color:#a6e22e">respond</span> <span style="color:#a6e22e">status</span> <span style="color:#ae81ff">404</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#ae81ff">0</span> <span style="color:#a6e22e">passing</span> (<span style="color:#ae81ff">17</span><span style="color:#a6e22e">ms</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#ae81ff">3</span> <span style="color:#a6e22e">failing</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#ae81ff">1</span>) <span style="color:#a6e22e">Server</span>
</span></span><span style="display:flex;"><span>       <span style="color:#a6e22e">should</span> <span style="color:#a6e22e">respond</span> <span style="color:#a6e22e">status</span> <span style="color:#ae81ff">200</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>     <span style="color:#a6e22e">TypeError</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">app</span>.<span style="color:#a6e22e">address</span> <span style="color:#a6e22e">is</span> <span style="color:#a6e22e">not</span> <span style="color:#a6e22e">a</span> <span style="color:#66d9ef">function</span>
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">at</span> <span style="color:#a6e22e">serverAddress</span> (<span style="color:#a6e22e">node_modules</span><span style="color:#f92672">/</span><span style="color:#a6e22e">chai</span><span style="color:#f92672">-</span><span style="color:#a6e22e">http</span><span style="color:#f92672">/</span><span style="color:#a6e22e">lib</span><span style="color:#f92672">/</span><span style="color:#a6e22e">request</span>.<span style="color:#a6e22e">js</span><span style="color:#f92672">:</span><span style="color:#ae81ff">282</span><span style="color:#f92672">:</span><span style="color:#ae81ff">18</span>)
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">at</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Test</span> (<span style="color:#a6e22e">node_modules</span><span style="color:#f92672">/</span><span style="color:#a6e22e">chai</span><span style="color:#f92672">-</span><span style="color:#a6e22e">http</span><span style="color:#f92672">/</span><span style="color:#a6e22e">lib</span><span style="color:#f92672">/</span><span style="color:#a6e22e">request</span>.<span style="color:#a6e22e">js</span><span style="color:#f92672">:</span><span style="color:#ae81ff">271</span><span style="color:#f92672">:</span><span style="color:#ae81ff">53</span>)
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">at</span> Object.<span style="color:#a6e22e">obj</span>.<span style="color:#f92672">&lt;</span><span style="color:#a6e22e">computed</span><span style="color:#f92672">&gt;</span> [<span style="color:#a6e22e">as</span> <span style="color:#a6e22e">get</span>] (<span style="color:#a6e22e">node_modules</span><span style="color:#f92672">/</span><span style="color:#a6e22e">chai</span><span style="color:#f92672">-</span><span style="color:#a6e22e">http</span><span style="color:#f92672">/</span><span style="color:#a6e22e">lib</span><span style="color:#f92672">/</span><span style="color:#a6e22e">request</span>.<span style="color:#a6e22e">js</span><span style="color:#f92672">:</span><span style="color:#ae81ff">239</span><span style="color:#f92672">:</span><span style="color:#ae81ff">14</span>)
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">at</span> <span style="color:#a6e22e">Context</span>.<span style="color:#f92672">&lt;</span><span style="color:#a6e22e">anonymous</span><span style="color:#f92672">&gt;</span> (<span style="color:#a6e22e">test</span><span style="color:#f92672">/</span><span style="color:#a6e22e">test</span>.<span style="color:#a6e22e">js</span><span style="color:#f92672">:</span><span style="color:#ae81ff">12</span><span style="color:#f92672">:</span><span style="color:#ae81ff">8</span>)
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">at</span> <span style="color:#a6e22e">processImmediate</span> (<span style="color:#a6e22e">internal</span><span style="color:#f92672">/</span><span style="color:#a6e22e">timers</span>.<span style="color:#a6e22e">js</span><span style="color:#f92672">:</span><span style="color:#ae81ff">456</span><span style="color:#f92672">:</span><span style="color:#ae81ff">21</span>)
</span></span></code></pre></div><p>如何解决：</p>
<p>在server.js的app.listen(port)前加上 module.exports =</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#a6e22e">app</span>.<span style="color:#a6e22e">listen</span>(<span style="color:#a6e22e">port</span>, () =&gt; {
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#e6db74">`My app listening at http://localhost:</span><span style="color:#e6db74">${</span><span style="color:#a6e22e">port</span><span style="color:#e6db74">}</span><span style="color:#e6db74">`</span>);
</span></span><span style="display:flex;"><span>});
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">//改为
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">module</span>.<span style="color:#a6e22e">exports</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">app</span>.<span style="color:#a6e22e">listen</span>(<span style="color:#a6e22e">port</span>, () =&gt; {
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#e6db74">`My app listening at http://localhost:</span><span style="color:#e6db74">${</span><span style="color:#a6e22e">port</span><span style="color:#e6db74">}</span><span style="color:#e6db74">`</span>);
</span></span><span style="display:flex;"><span>});
</span></span></code></pre></div></div>
    </div>

        </div><script src="/js/highlight.min.js"></script>
<script type="text/javascript">
    document.addEventListener("DOMContentLoaded", (event) => {
        document.querySelectorAll("pre").forEach((block) => {
            hljs.highlightBlock(block);
        });
        
        
        
        
        
        
        
        
        
        
    });
</script>
</body>
</html>
