<!DOCTYPE html>
<html lang="zh-CN"><head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta
        name="viewport"
        content="width=device-width,initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no"
    />
    <meta name="keywords" content="pengjielee,个人博客" />
    <meta name="description" content="Pengjielee的个人博客" />
    <title>Pengjielee&#39;s blog</title>

    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700" />
    <link rel="stylesheet" href="/css/style.css" />
</head>
<body><div id="main">
            <nav class="nav">
    <a href="/">首页</a> <span class="divide">|</span>
    <a href="/categories">分类</a>
    <span class="divide">|</span> <a href="/tags">标签</a>
    <span class="divide">|</span>
    <a href="/post">归档</a>
</nav>

    <div class="page page-single">
        <header class="header">
            <h1 class="title"></h1><div class="post-meta">
    <div class="date">0001-01-01</div>
</div>
</header>
        <div class="content"><h2 id="未使用web-worker计算斐波那契数列">未使用Web Worker计算斐波那契数列</h2>
<p><img src="https://cdn.nlark.com/yuque/0/2020/gif/188528/1603442748471-040fa8c6-c3c8-4174-9e88-00f887c5e17a.gif#align=left&amp;display=inline&amp;height=462&amp;margin=%5Bobject%20Object%5D&amp;name=webworker01.gif&amp;originHeight=462&amp;originWidth=640&amp;size=1290833&amp;status=done&amp;style=none&amp;width=640" alt="webworker01.gif"></p>
<ul>
<li>计算较小数时，浏览器还可以快速响应；</li>
<li>计算大数时，浏览器的UI已经不可以操作了；</li>
<li>刷新一下页面，发现浏览器仍然处于卡死状态；</li>
</ul>
<h2 id="使用web-worker计算斐波那契数列">使用Web Worker计算斐波那契数列</h2>
<p>1、创建项目</p>
<pre tabindex="0"><code>$ mkdir webworker-demo
$ cd webworker-demo
$ touch index.html main.js worker.js
</code></pre><p>2、index.html</p>
<pre tabindex="0"><code>&lt;html lang=&#34;en&#34;&gt;
  &lt;head&gt;
    &lt;title&gt;计算斐波那契数列（使用Web Worker）&lt;/title&gt;
    &lt;meta charset=&#34;UTF-8&#34; /&gt; 
  &lt;/head&gt;
  &lt;body&gt;
    &lt;div id=&#34;app&#34;&gt;
      &lt;h3&gt;计算斐波那契数列（使用Web Worker）&lt;/h3&gt;
      &lt;div class=&#34;inner&#34;&gt;
        &lt;input type=&#34;number&#34; id=&#34;number&#34; /&gt;
        &lt;button id=&#34;calc&#34;&gt;calculate&lt;/button&gt;
        &lt;div id=&#34;result&#34;&gt;&lt;/div&gt;
      &lt;/div&gt;
    &lt;/div&gt;
  &lt;/body&gt;
  &lt;script src=&#34;main.js&#34;&gt;&lt;/script&gt;
&lt;/html&gt;
</code></pre><p>3、main.js</p>
<pre tabindex="0"><code>const resultEle = document.querySelector(&#39;#result&#39;);
// 判断是否支持Worker
if(window.Worker){
	// 创建Worker
	const myWorker = new Worker(&#34;worker.js&#34;);
	// 监听消息
	myWorker.onmessage = e =&gt; {
  const result = e.data;
  resultEle.innerHTML = result;
	};
	// 处理错误
	myWorker.onerror = e =&gt; {
  resultEle.innerHTML = e.message;
	};
	document.querySelector(&#39;#calc&#39;).onclick = function(){
  resultEle.innerHTML = &#39;calculating...&#39;;
  var number = document.querySelector(&#39;#number&#39;).value;
  // 向worker.js发送数据
  myWorker.postMessage(number);
	}
}
</code></pre><p>4、worker.js</p>
<pre tabindex="0"><code>// 计算斐波那契数列
const Fibonacci = (n) =&gt; {
	if(n &lt;= 0) { return 0; }
  if(n === 1) { return 1; }
  return Fibonacci(n - 1) + Fibonacci(n - 2);
}
// 监听消息
onmessage = e =&gt; {
	const number = e.data;
	const result = Fibonacci(number);
	// 向main.js发送计算后的结果
	postMessage(result);
};
</code></pre><h2 id="完整代码">完整代码</h2>
<p><a href="https://github.com/pengjielee/learn-demo/tree/main/demos/webworker-demo">webworker-demo</a></p>
</div>
    </div>

        </div></body>
</html>
