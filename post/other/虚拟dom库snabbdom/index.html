<!DOCTYPE html>
<html lang="zh-CN"><head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta
        name="viewport"
        content="width=device-width,initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no"
    />
    <meta name="keywords" content="pengjielee,个人博客" />
    <meta name="description" content="Pengjielee的个人博客" />
    <title>Pengjielee&#39;s blog</title>

    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700" />
    <link rel="stylesheet" href="/css/style.css" />
</head>
<body><div id="main">
            <nav class="nav">
    <a href="/">首页</a> <span class="divide">|</span>
    <a href="/categories">分类</a>
    <span class="divide">|</span> <a href="/tags">标签</a>
    <span class="divide">|</span>
    <a href="/post">归档</a>
</nav>

    <div class="page page-single">
        <header class="header">
            <h1 class="title"></h1><div class="post-meta">
    <div class="date">0001-01-01</div>
</div>
</header>
        <div class="content"><h2 id="定义虚拟节点">定义虚拟节点</h2>
<p>//vnode.js</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">vnode</span>(<span style="color:#a6e22e">sel</span>, <span style="color:#a6e22e">data</span>, <span style="color:#a6e22e">children</span>, <span style="color:#a6e22e">text</span>, <span style="color:#a6e22e">elm</span>) {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">key</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">data</span> <span style="color:#f92672">===</span> <span style="color:#66d9ef">undefined</span> <span style="color:#f92672">?</span> <span style="color:#66d9ef">undefined</span> <span style="color:#f92672">:</span> <span style="color:#a6e22e">data</span>.<span style="color:#a6e22e">key</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span> { <span style="color:#a6e22e">sel</span>, <span style="color:#a6e22e">data</span>, <span style="color:#a6e22e">children</span>, <span style="color:#a6e22e">text</span>, <span style="color:#a6e22e">elm</span>, <span style="color:#a6e22e">key</span> };
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h2 id="辅助方法">辅助方法</h2>
<p>//is.js</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">primitive</span>(<span style="color:#a6e22e">s</span>) {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">typeof</span> <span style="color:#a6e22e">s</span> <span style="color:#f92672">===</span> <span style="color:#e6db74">&#34;string&#34;</span> <span style="color:#f92672">||</span> <span style="color:#66d9ef">typeof</span> <span style="color:#a6e22e">s</span> <span style="color:#f92672">===</span> <span style="color:#e6db74">&#34;number&#34;</span>;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">is</span> <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">primitive</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">primitive</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">array</span><span style="color:#f92672">:</span> Array.<span style="color:#a6e22e">isArray</span>,
</span></span><span style="display:flex;"><span>};
</span></span></code></pre></div><h2 id="h函数">h函数</h2>
<p>h.js</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">h</span>(<span style="color:#a6e22e">sel</span>, <span style="color:#a6e22e">b</span>, <span style="color:#a6e22e">c</span>) {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">data</span> <span style="color:#f92672">=</span> {};
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">children</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">text</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">i</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">c</span> <span style="color:#f92672">!==</span> <span style="color:#66d9ef">undefined</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">b</span> <span style="color:#f92672">!==</span> <span style="color:#66d9ef">null</span>) {
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">data</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">b</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">is</span>.<span style="color:#a6e22e">array</span>(<span style="color:#a6e22e">c</span>)) {
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">children</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>;
</span></span><span style="display:flex;"><span>    } <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">is</span>.<span style="color:#a6e22e">primitive</span>(<span style="color:#a6e22e">c</span>)) {
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">text</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>;
</span></span><span style="display:flex;"><span>    } <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">c</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#a6e22e">c</span>.<span style="color:#a6e22e">sel</span>) {
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">children</span> <span style="color:#f92672">=</span> [<span style="color:#a6e22e">c</span>];
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  } <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">b</span> <span style="color:#f92672">!==</span> <span style="color:#66d9ef">undefined</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#a6e22e">b</span> <span style="color:#f92672">!==</span> <span style="color:#66d9ef">null</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">is</span>.<span style="color:#a6e22e">array</span>(<span style="color:#a6e22e">b</span>)) {
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">children</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">b</span>;
</span></span><span style="display:flex;"><span>    } <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">is</span>.<span style="color:#a6e22e">primitive</span>(<span style="color:#a6e22e">b</span>)) {
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">text</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">b</span>;
</span></span><span style="display:flex;"><span>    } <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">b</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#a6e22e">b</span>.<span style="color:#a6e22e">sel</span>) {
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">children</span> <span style="color:#f92672">=</span> [<span style="color:#a6e22e">b</span>];
</span></span><span style="display:flex;"><span>    } <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">data</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">b</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">children</span> <span style="color:#f92672">!==</span> <span style="color:#66d9ef">undefined</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> (<span style="color:#a6e22e">i</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; <span style="color:#a6e22e">i</span> <span style="color:#f92672">&lt;</span> <span style="color:#a6e22e">children</span>.<span style="color:#a6e22e">length</span>; <span style="color:#f92672">++</span><span style="color:#a6e22e">i</span>) {
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">is</span>.<span style="color:#a6e22e">primitive</span>(<span style="color:#a6e22e">children</span>[<span style="color:#a6e22e">i</span>])) <span style="color:#a6e22e">children</span>[<span style="color:#a6e22e">i</span>] <span style="color:#f92672">=</span> <span style="color:#a6e22e">vnode</span>(<span style="color:#66d9ef">undefined</span>, <span style="color:#66d9ef">undefined</span>, <span style="color:#66d9ef">undefined</span>, <span style="color:#a6e22e">children</span>[<span style="color:#a6e22e">i</span>], <span style="color:#66d9ef">undefined</span>);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// if (sel[0] === &#34;s&#34; &amp;&amp; sel[1] === &#34;v&#34; &amp;&amp; sel[2] === &#34;g&#34; &amp;&amp; (sel.length === 3 || sel[3] === &#34;.&#34; || sel[3] === &#34;#&#34;)) {
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#75715e">//   addNS(data, children, sel);
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#75715e">// }
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">vnode</span>(<span style="color:#a6e22e">sel</span>, <span style="color:#a6e22e">data</span>, <span style="color:#a6e22e">children</span>, <span style="color:#a6e22e">text</span>, <span style="color:#66d9ef">undefined</span>);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h2 id="dom操作方法">dom操作方法</h2>
<p>//htmldomapi.js</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">createElement</span>(<span style="color:#a6e22e">tagName</span>, <span style="color:#a6e22e">options</span>) {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span> document.<span style="color:#a6e22e">createElement</span>(<span style="color:#a6e22e">tagName</span>, <span style="color:#a6e22e">options</span>);
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">createElementNS</span>(<span style="color:#a6e22e">namespaceURI</span>, <span style="color:#a6e22e">qualifiedName</span>, <span style="color:#a6e22e">options</span>) {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span> document.<span style="color:#a6e22e">createElementNS</span>(<span style="color:#a6e22e">namespaceURI</span>, <span style="color:#a6e22e">qualifiedName</span>, <span style="color:#a6e22e">options</span>);
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">createTextNode</span>(<span style="color:#a6e22e">text</span>) {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span> document.<span style="color:#a6e22e">createTextNode</span>(<span style="color:#a6e22e">text</span>);
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">createComment</span>(<span style="color:#a6e22e">text</span>) {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span> document.<span style="color:#a6e22e">createComment</span>(<span style="color:#a6e22e">text</span>);
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">insertBefore</span>(<span style="color:#a6e22e">parentNode</span>, <span style="color:#a6e22e">newNode</span>, <span style="color:#a6e22e">referenceNode</span>) {
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">parentNode</span>.<span style="color:#a6e22e">insertBefore</span>(<span style="color:#a6e22e">newNode</span>, <span style="color:#a6e22e">referenceNode</span>);
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">removeChild</span>(<span style="color:#a6e22e">node</span>, <span style="color:#a6e22e">child</span>) {
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">node</span>.<span style="color:#a6e22e">removeChild</span>(<span style="color:#a6e22e">child</span>);
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">appendChild</span>(<span style="color:#a6e22e">node</span>, <span style="color:#a6e22e">child</span>) {
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">node</span>.<span style="color:#a6e22e">appendChild</span>(<span style="color:#a6e22e">child</span>);
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">parentNode</span>(<span style="color:#a6e22e">node</span>) {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">node</span>.<span style="color:#a6e22e">parentNode</span>;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">nextSibling</span>(<span style="color:#a6e22e">node</span>) {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">node</span>.<span style="color:#a6e22e">nextSibling</span>;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">tagName</span>(<span style="color:#a6e22e">elm</span>) {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">elm</span>.<span style="color:#a6e22e">tagName</span>;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">setTextContent</span>(<span style="color:#a6e22e">node</span>, <span style="color:#a6e22e">text</span>) {
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">node</span>.<span style="color:#a6e22e">textContent</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">text</span>;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">getTextContent</span>(<span style="color:#a6e22e">node</span>) {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">node</span>.<span style="color:#a6e22e">textContent</span>;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">isElement</span>(<span style="color:#a6e22e">node</span>) {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">node</span>.<span style="color:#a6e22e">nodeType</span> <span style="color:#f92672">===</span> <span style="color:#ae81ff">1</span>;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">isText</span>(<span style="color:#a6e22e">node</span>) {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">node</span>.<span style="color:#a6e22e">nodeType</span> <span style="color:#f92672">===</span> <span style="color:#ae81ff">3</span>;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">isComment</span>(<span style="color:#a6e22e">node</span>) {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">node</span>.<span style="color:#a6e22e">nodeType</span> <span style="color:#f92672">===</span> <span style="color:#ae81ff">8</span>;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">htmlDomApi</span> <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">createElement</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">createElementNS</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">createTextNode</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">createComment</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">insertBefore</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">removeChild</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">appendChild</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">parentNode</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">nextSibling</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">tagName</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">setTextContent</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">getTextContent</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">isElement</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">isText</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">isComment</span>,
</span></span><span style="display:flex;"><span>};
</span></span></code></pre></div><h2 id="初始化方法">初始化方法</h2>
<p>//init.js</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">isUndef</span>(<span style="color:#a6e22e">s</span>) {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">s</span> <span style="color:#f92672">===</span> <span style="color:#66d9ef">undefined</span>;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">isDef</span>(<span style="color:#a6e22e">s</span>) {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">s</span> <span style="color:#f92672">!==</span> <span style="color:#66d9ef">undefined</span>;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">emptyNode</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">vnode</span>(<span style="color:#e6db74">&#34;&#34;</span>, {}, [], <span style="color:#66d9ef">undefined</span>, <span style="color:#66d9ef">undefined</span>);
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">sameVnode</span>(<span style="color:#a6e22e">vnode1</span>, <span style="color:#a6e22e">vnode2</span>) {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">_a</span>, <span style="color:#a6e22e">_b</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">isSameKey</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">vnode1</span>.<span style="color:#a6e22e">key</span> <span style="color:#f92672">===</span> <span style="color:#a6e22e">vnode2</span>.<span style="color:#a6e22e">key</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">isSameIs</span> <span style="color:#f92672">=</span> ((<span style="color:#a6e22e">_a</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">vnode1</span>.<span style="color:#a6e22e">data</span>) <span style="color:#f92672">===</span> <span style="color:#66d9ef">null</span> <span style="color:#f92672">||</span> <span style="color:#a6e22e">_a</span> <span style="color:#f92672">===</span> <span style="color:#66d9ef">void</span> <span style="color:#ae81ff">0</span> <span style="color:#f92672">?</span> <span style="color:#66d9ef">void</span> <span style="color:#ae81ff">0</span> <span style="color:#f92672">:</span> <span style="color:#a6e22e">_a</span>.<span style="color:#a6e22e">is</span>) <span style="color:#f92672">===</span> ((<span style="color:#a6e22e">_b</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">vnode2</span>.<span style="color:#a6e22e">data</span>) <span style="color:#f92672">===</span> <span style="color:#66d9ef">null</span> <span style="color:#f92672">||</span> <span style="color:#a6e22e">_b</span> <span style="color:#f92672">===</span> <span style="color:#66d9ef">void</span> <span style="color:#ae81ff">0</span> <span style="color:#f92672">?</span> <span style="color:#66d9ef">void</span> <span style="color:#ae81ff">0</span> <span style="color:#f92672">:</span> <span style="color:#a6e22e">_b</span>.<span style="color:#a6e22e">is</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">isSameSel</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">vnode1</span>.<span style="color:#a6e22e">sel</span> <span style="color:#f92672">===</span> <span style="color:#a6e22e">vnode2</span>.<span style="color:#a6e22e">sel</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">isSameSel</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#a6e22e">isSameKey</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#a6e22e">isSameIs</span>;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">isVnode</span>(<span style="color:#a6e22e">vnode</span>) {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">vnode</span>.<span style="color:#a6e22e">sel</span> <span style="color:#f92672">!==</span> <span style="color:#66d9ef">undefined</span>;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">createKeyToOldIdx</span>(<span style="color:#a6e22e">children</span>, <span style="color:#a6e22e">beginIdx</span>, <span style="color:#a6e22e">endIdx</span>) {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">_a</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">map</span> <span style="color:#f92672">=</span> {};
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">let</span> <span style="color:#a6e22e">i</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">beginIdx</span>; <span style="color:#a6e22e">i</span> <span style="color:#f92672">&lt;=</span> <span style="color:#a6e22e">endIdx</span>; <span style="color:#f92672">++</span><span style="color:#a6e22e">i</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">key</span> <span style="color:#f92672">=</span> (<span style="color:#a6e22e">_a</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">children</span>[<span style="color:#a6e22e">i</span>]) <span style="color:#f92672">===</span> <span style="color:#66d9ef">null</span> <span style="color:#f92672">||</span> <span style="color:#a6e22e">_a</span> <span style="color:#f92672">===</span> <span style="color:#66d9ef">void</span> <span style="color:#ae81ff">0</span> <span style="color:#f92672">?</span> <span style="color:#66d9ef">void</span> <span style="color:#ae81ff">0</span> <span style="color:#f92672">:</span> <span style="color:#a6e22e">_a</span>.<span style="color:#a6e22e">key</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">key</span> <span style="color:#f92672">!==</span> <span style="color:#66d9ef">undefined</span>) {
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">map</span>[<span style="color:#a6e22e">key</span>] <span style="color:#f92672">=</span> <span style="color:#a6e22e">i</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">map</span>;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">hooks</span> <span style="color:#f92672">=</span> [<span style="color:#e6db74">&#34;create&#34;</span>, <span style="color:#e6db74">&#34;update&#34;</span>, <span style="color:#e6db74">&#34;remove&#34;</span>, <span style="color:#e6db74">&#34;destroy&#34;</span>, <span style="color:#e6db74">&#34;pre&#34;</span>, <span style="color:#e6db74">&#34;post&#34;</span>];
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">init</span>(<span style="color:#a6e22e">modules</span>, <span style="color:#a6e22e">domApi</span>) {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">i</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">j</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">cbs</span> <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">create</span><span style="color:#f92672">:</span> [],
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">update</span><span style="color:#f92672">:</span> [],
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">remove</span><span style="color:#f92672">:</span> [],
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">destroy</span><span style="color:#f92672">:</span> [],
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">pre</span><span style="color:#f92672">:</span> [],
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">post</span><span style="color:#f92672">:</span> [],
</span></span><span style="display:flex;"><span>  };
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">api</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">domApi</span> <span style="color:#f92672">!==</span> <span style="color:#66d9ef">undefined</span> <span style="color:#f92672">?</span> <span style="color:#a6e22e">domApi</span> <span style="color:#f92672">:</span> <span style="color:#a6e22e">htmlDomApi</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">for</span> (<span style="color:#a6e22e">i</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; <span style="color:#a6e22e">i</span> <span style="color:#f92672">&lt;</span> <span style="color:#a6e22e">hooks</span>.<span style="color:#a6e22e">length</span>; <span style="color:#f92672">++</span><span style="color:#a6e22e">i</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">cbs</span>[<span style="color:#a6e22e">hooks</span>[<span style="color:#a6e22e">i</span>]] <span style="color:#f92672">=</span> [];
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> (<span style="color:#a6e22e">j</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; <span style="color:#a6e22e">j</span> <span style="color:#f92672">&lt;</span> <span style="color:#a6e22e">modules</span>.<span style="color:#a6e22e">length</span>; <span style="color:#f92672">++</span><span style="color:#a6e22e">j</span>) {
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">hook</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">modules</span>[<span style="color:#a6e22e">j</span>][<span style="color:#a6e22e">hooks</span>[<span style="color:#a6e22e">i</span>]];
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">hook</span> <span style="color:#f92672">!==</span> <span style="color:#66d9ef">undefined</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">cbs</span>[<span style="color:#a6e22e">hooks</span>[<span style="color:#a6e22e">i</span>]].<span style="color:#a6e22e">push</span>(<span style="color:#a6e22e">hook</span>);
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">emptyNodeAt</span>(<span style="color:#a6e22e">elm</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">id</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">elm</span>.<span style="color:#a6e22e">id</span> <span style="color:#f92672">?</span> <span style="color:#e6db74">&#34;#&#34;</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">elm</span>.<span style="color:#a6e22e">id</span> <span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;&#34;</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">c</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">elm</span>.<span style="color:#a6e22e">className</span> <span style="color:#f92672">?</span> <span style="color:#e6db74">&#34;.&#34;</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">elm</span>.<span style="color:#a6e22e">className</span>.<span style="color:#a6e22e">split</span>(<span style="color:#e6db74">&#34; &#34;</span>).<span style="color:#a6e22e">join</span>(<span style="color:#e6db74">&#34;.&#34;</span>) <span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;&#34;</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">vnode</span>(<span style="color:#a6e22e">api</span>.<span style="color:#a6e22e">tagName</span>(<span style="color:#a6e22e">elm</span>).<span style="color:#a6e22e">toLowerCase</span>() <span style="color:#f92672">+</span> <span style="color:#a6e22e">id</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">c</span>, {}, [], <span style="color:#66d9ef">undefined</span>, <span style="color:#a6e22e">elm</span>);
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">createRmCb</span>(<span style="color:#a6e22e">childElm</span>, <span style="color:#a6e22e">listeners</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">rmCb</span>() {
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">if</span> (<span style="color:#f92672">--</span><span style="color:#a6e22e">listeners</span> <span style="color:#f92672">===</span> <span style="color:#ae81ff">0</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">parent</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">api</span>.<span style="color:#a6e22e">parentNode</span>(<span style="color:#a6e22e">childElm</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">api</span>.<span style="color:#a6e22e">removeChild</span>(<span style="color:#a6e22e">parent</span>, <span style="color:#a6e22e">childElm</span>);
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>    };
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">createElm</span>(<span style="color:#a6e22e">vnode</span>, <span style="color:#a6e22e">insertedVnodeQueue</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">_a</span>, <span style="color:#a6e22e">_b</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">i</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">data</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">vnode</span>.<span style="color:#a6e22e">data</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">data</span> <span style="color:#f92672">!==</span> <span style="color:#66d9ef">undefined</span>) {
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">init</span> <span style="color:#f92672">=</span> (<span style="color:#a6e22e">_a</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">data</span>.<span style="color:#a6e22e">hook</span>) <span style="color:#f92672">===</span> <span style="color:#66d9ef">null</span> <span style="color:#f92672">||</span> <span style="color:#a6e22e">_a</span> <span style="color:#f92672">===</span> <span style="color:#66d9ef">void</span> <span style="color:#ae81ff">0</span> <span style="color:#f92672">?</span> <span style="color:#66d9ef">void</span> <span style="color:#ae81ff">0</span> <span style="color:#f92672">:</span> <span style="color:#a6e22e">_a</span>.<span style="color:#a6e22e">init</span>;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">isDef</span>(<span style="color:#a6e22e">init</span>)) {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">init</span>(<span style="color:#a6e22e">vnode</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">data</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">vnode</span>.<span style="color:#a6e22e">data</span>;
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">children</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">vnode</span>.<span style="color:#a6e22e">children</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">sel</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">vnode</span>.<span style="color:#a6e22e">sel</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">sel</span> <span style="color:#f92672">===</span> <span style="color:#e6db74">&#34;!&#34;</span>) {
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">isUndef</span>(<span style="color:#a6e22e">vnode</span>.<span style="color:#a6e22e">text</span>)) {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">vnode</span>.<span style="color:#a6e22e">text</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;&#34;</span>;
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">vnode</span>.<span style="color:#a6e22e">elm</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">api</span>.<span style="color:#a6e22e">createComment</span>(<span style="color:#a6e22e">vnode</span>.<span style="color:#a6e22e">text</span>);
</span></span><span style="display:flex;"><span>    } <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">sel</span> <span style="color:#f92672">!==</span> <span style="color:#66d9ef">undefined</span>) {
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">// Parse selector
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>      <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">hashIdx</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">sel</span>.<span style="color:#a6e22e">indexOf</span>(<span style="color:#e6db74">&#34;#&#34;</span>);
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">dotIdx</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">sel</span>.<span style="color:#a6e22e">indexOf</span>(<span style="color:#e6db74">&#34;.&#34;</span>, <span style="color:#a6e22e">hashIdx</span>);
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">hash</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">hashIdx</span> <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0</span> <span style="color:#f92672">?</span> <span style="color:#a6e22e">hashIdx</span> <span style="color:#f92672">:</span> <span style="color:#a6e22e">sel</span>.<span style="color:#a6e22e">length</span>;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">dot</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">dotIdx</span> <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0</span> <span style="color:#f92672">?</span> <span style="color:#a6e22e">dotIdx</span> <span style="color:#f92672">:</span> <span style="color:#a6e22e">sel</span>.<span style="color:#a6e22e">length</span>;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">tag</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">hashIdx</span> <span style="color:#f92672">!==</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span> <span style="color:#f92672">||</span> <span style="color:#a6e22e">dotIdx</span> <span style="color:#f92672">!==</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span> <span style="color:#f92672">?</span> <span style="color:#a6e22e">sel</span>.<span style="color:#a6e22e">slice</span>(<span style="color:#ae81ff">0</span>, Math.<span style="color:#a6e22e">min</span>(<span style="color:#a6e22e">hash</span>, <span style="color:#a6e22e">dot</span>)) <span style="color:#f92672">:</span> <span style="color:#a6e22e">sel</span>;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">elm</span> <span style="color:#f92672">=</span> (<span style="color:#a6e22e">vnode</span>.<span style="color:#a6e22e">elm</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">isDef</span>(<span style="color:#a6e22e">data</span>) <span style="color:#f92672">&amp;&amp;</span> <span style="color:#a6e22e">isDef</span>((<span style="color:#a6e22e">i</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">data</span>.<span style="color:#a6e22e">ns</span>)) <span style="color:#f92672">?</span> <span style="color:#a6e22e">api</span>.<span style="color:#a6e22e">createElementNS</span>(<span style="color:#a6e22e">i</span>, <span style="color:#a6e22e">tag</span>, <span style="color:#a6e22e">data</span>) <span style="color:#f92672">:</span> <span style="color:#a6e22e">api</span>.<span style="color:#a6e22e">createElement</span>(<span style="color:#a6e22e">tag</span>, <span style="color:#a6e22e">data</span>));
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">hash</span> <span style="color:#f92672">&lt;</span> <span style="color:#a6e22e">dot</span>) <span style="color:#a6e22e">elm</span>.<span style="color:#a6e22e">setAttribute</span>(<span style="color:#e6db74">&#34;id&#34;</span>, <span style="color:#a6e22e">sel</span>.<span style="color:#a6e22e">slice</span>(<span style="color:#a6e22e">hash</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>, <span style="color:#a6e22e">dot</span>));
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">dotIdx</span> <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0</span>) <span style="color:#a6e22e">elm</span>.<span style="color:#a6e22e">setAttribute</span>(<span style="color:#e6db74">&#34;class&#34;</span>, <span style="color:#a6e22e">sel</span>.<span style="color:#a6e22e">slice</span>(<span style="color:#a6e22e">dot</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>).<span style="color:#a6e22e">replace</span>(<span style="color:#e6db74">/\./g</span>, <span style="color:#e6db74">&#34; &#34;</span>));
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">for</span> (<span style="color:#a6e22e">i</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; <span style="color:#a6e22e">i</span> <span style="color:#f92672">&lt;</span> <span style="color:#a6e22e">cbs</span>.<span style="color:#a6e22e">create</span>.<span style="color:#a6e22e">length</span>; <span style="color:#f92672">++</span><span style="color:#a6e22e">i</span>) <span style="color:#a6e22e">cbs</span>.<span style="color:#a6e22e">create</span>[<span style="color:#a6e22e">i</span>](<span style="color:#a6e22e">emptyNode</span>, <span style="color:#a6e22e">vnode</span>);
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">is</span>.<span style="color:#a6e22e">array</span>(<span style="color:#a6e22e">children</span>)) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> (<span style="color:#a6e22e">i</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; <span style="color:#a6e22e">i</span> <span style="color:#f92672">&lt;</span> <span style="color:#a6e22e">children</span>.<span style="color:#a6e22e">length</span>; <span style="color:#f92672">++</span><span style="color:#a6e22e">i</span>) {
</span></span><span style="display:flex;"><span>          <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">ch</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">children</span>[<span style="color:#a6e22e">i</span>];
</span></span><span style="display:flex;"><span>          <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">ch</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span>) {
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">api</span>.<span style="color:#a6e22e">appendChild</span>(<span style="color:#a6e22e">elm</span>, <span style="color:#a6e22e">createElm</span>(<span style="color:#a6e22e">ch</span>, <span style="color:#a6e22e">insertedVnodeQueue</span>));
</span></span><span style="display:flex;"><span>          }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>      } <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">is</span>.<span style="color:#a6e22e">primitive</span>(<span style="color:#a6e22e">vnode</span>.<span style="color:#a6e22e">text</span>)) {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">api</span>.<span style="color:#a6e22e">appendChild</span>(<span style="color:#a6e22e">elm</span>, <span style="color:#a6e22e">api</span>.<span style="color:#a6e22e">createTextNode</span>(<span style="color:#a6e22e">vnode</span>.<span style="color:#a6e22e">text</span>));
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">hook</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">vnode</span>.<span style="color:#a6e22e">data</span>.<span style="color:#a6e22e">hook</span>;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">isDef</span>(<span style="color:#a6e22e">hook</span>)) {
</span></span><span style="display:flex;"><span>        (<span style="color:#a6e22e">_b</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">hook</span>.<span style="color:#a6e22e">create</span>) <span style="color:#f92672">===</span> <span style="color:#66d9ef">null</span> <span style="color:#f92672">||</span> <span style="color:#a6e22e">_b</span> <span style="color:#f92672">===</span> <span style="color:#66d9ef">void</span> <span style="color:#ae81ff">0</span> <span style="color:#f92672">?</span> <span style="color:#66d9ef">void</span> <span style="color:#ae81ff">0</span> <span style="color:#f92672">:</span> <span style="color:#a6e22e">_b</span>.<span style="color:#a6e22e">call</span>(<span style="color:#a6e22e">hook</span>, <span style="color:#a6e22e">emptyNode</span>, <span style="color:#a6e22e">vnode</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">hook</span>.<span style="color:#a6e22e">insert</span>) {
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">insertedVnodeQueue</span>.<span style="color:#a6e22e">push</span>(<span style="color:#a6e22e">vnode</span>);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>    } <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">vnode</span>.<span style="color:#a6e22e">elm</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">api</span>.<span style="color:#a6e22e">createTextNode</span>(<span style="color:#a6e22e">vnode</span>.<span style="color:#a6e22e">text</span>);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">vnode</span>.<span style="color:#a6e22e">elm</span>;
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">addVnodes</span>(<span style="color:#a6e22e">parentElm</span>, <span style="color:#a6e22e">before</span>, <span style="color:#a6e22e">vnodes</span>, <span style="color:#a6e22e">startIdx</span>, <span style="color:#a6e22e">endIdx</span>, <span style="color:#a6e22e">insertedVnodeQueue</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> (; <span style="color:#a6e22e">startIdx</span> <span style="color:#f92672">&lt;=</span> <span style="color:#a6e22e">endIdx</span>; <span style="color:#f92672">++</span><span style="color:#a6e22e">startIdx</span>) {
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">ch</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">vnodes</span>[<span style="color:#a6e22e">startIdx</span>];
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">ch</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">api</span>.<span style="color:#a6e22e">insertBefore</span>(<span style="color:#a6e22e">parentElm</span>, <span style="color:#a6e22e">createElm</span>(<span style="color:#a6e22e">ch</span>, <span style="color:#a6e22e">insertedVnodeQueue</span>), <span style="color:#a6e22e">before</span>);
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">invokeDestroyHook</span>(<span style="color:#a6e22e">vnode</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">_a</span>, <span style="color:#a6e22e">_b</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">data</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">vnode</span>.<span style="color:#a6e22e">data</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">data</span> <span style="color:#f92672">!==</span> <span style="color:#66d9ef">undefined</span>) {
</span></span><span style="display:flex;"><span>      (<span style="color:#a6e22e">_b</span> <span style="color:#f92672">=</span> (<span style="color:#a6e22e">_a</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">data</span> <span style="color:#f92672">===</span> <span style="color:#66d9ef">null</span> <span style="color:#f92672">||</span> <span style="color:#a6e22e">data</span> <span style="color:#f92672">===</span> <span style="color:#66d9ef">void</span> <span style="color:#ae81ff">0</span> <span style="color:#f92672">?</span> <span style="color:#66d9ef">void</span> <span style="color:#ae81ff">0</span> <span style="color:#f92672">:</span> <span style="color:#a6e22e">data</span>.<span style="color:#a6e22e">hook</span>) <span style="color:#f92672">===</span> <span style="color:#66d9ef">null</span> <span style="color:#f92672">||</span> <span style="color:#a6e22e">_a</span> <span style="color:#f92672">===</span> <span style="color:#66d9ef">void</span> <span style="color:#ae81ff">0</span> <span style="color:#f92672">?</span> <span style="color:#66d9ef">void</span> <span style="color:#ae81ff">0</span> <span style="color:#f92672">:</span> <span style="color:#a6e22e">_a</span>.<span style="color:#a6e22e">destroy</span>) <span style="color:#f92672">===</span> <span style="color:#66d9ef">null</span> <span style="color:#f92672">||</span> <span style="color:#a6e22e">_b</span> <span style="color:#f92672">===</span> <span style="color:#66d9ef">void</span> <span style="color:#ae81ff">0</span> <span style="color:#f92672">?</span> <span style="color:#66d9ef">void</span> <span style="color:#ae81ff">0</span> <span style="color:#f92672">:</span> <span style="color:#a6e22e">_b</span>.<span style="color:#a6e22e">call</span>(<span style="color:#a6e22e">_a</span>, <span style="color:#a6e22e">vnode</span>);
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">let</span> <span style="color:#a6e22e">i</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; <span style="color:#a6e22e">i</span> <span style="color:#f92672">&lt;</span> <span style="color:#a6e22e">cbs</span>.<span style="color:#a6e22e">destroy</span>.<span style="color:#a6e22e">length</span>; <span style="color:#f92672">++</span><span style="color:#a6e22e">i</span>) <span style="color:#a6e22e">cbs</span>.<span style="color:#a6e22e">destroy</span>[<span style="color:#a6e22e">i</span>](<span style="color:#a6e22e">vnode</span>);
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">vnode</span>.<span style="color:#a6e22e">children</span> <span style="color:#f92672">!==</span> <span style="color:#66d9ef">undefined</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">let</span> <span style="color:#a6e22e">j</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; <span style="color:#a6e22e">j</span> <span style="color:#f92672">&lt;</span> <span style="color:#a6e22e">vnode</span>.<span style="color:#a6e22e">children</span>.<span style="color:#a6e22e">length</span>; <span style="color:#f92672">++</span><span style="color:#a6e22e">j</span>) {
</span></span><span style="display:flex;"><span>          <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">child</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">vnode</span>.<span style="color:#a6e22e">children</span>[<span style="color:#a6e22e">j</span>];
</span></span><span style="display:flex;"><span>          <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">child</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#66d9ef">typeof</span> <span style="color:#a6e22e">child</span> <span style="color:#f92672">!==</span> <span style="color:#e6db74">&#34;string&#34;</span>) {
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">invokeDestroyHook</span>(<span style="color:#a6e22e">child</span>);
</span></span><span style="display:flex;"><span>          }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">removeVnodes</span>(<span style="color:#a6e22e">parentElm</span>, <span style="color:#a6e22e">vnodes</span>, <span style="color:#a6e22e">startIdx</span>, <span style="color:#a6e22e">endIdx</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">_a</span>, <span style="color:#a6e22e">_b</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> (; <span style="color:#a6e22e">startIdx</span> <span style="color:#f92672">&lt;=</span> <span style="color:#a6e22e">endIdx</span>; <span style="color:#f92672">++</span><span style="color:#a6e22e">startIdx</span>) {
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">listeners</span>;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">rm</span>;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">ch</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">vnodes</span>[<span style="color:#a6e22e">startIdx</span>];
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">ch</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">isDef</span>(<span style="color:#a6e22e">ch</span>.<span style="color:#a6e22e">sel</span>)) {
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">invokeDestroyHook</span>(<span style="color:#a6e22e">ch</span>);
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">listeners</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">cbs</span>.<span style="color:#a6e22e">remove</span>.<span style="color:#a6e22e">length</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>;
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">rm</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">createRmCb</span>(<span style="color:#a6e22e">ch</span>.<span style="color:#a6e22e">elm</span>, <span style="color:#a6e22e">listeners</span>);
</span></span><span style="display:flex;"><span>          <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">let</span> <span style="color:#a6e22e">i</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; <span style="color:#a6e22e">i</span> <span style="color:#f92672">&lt;</span> <span style="color:#a6e22e">cbs</span>.<span style="color:#a6e22e">remove</span>.<span style="color:#a6e22e">length</span>; <span style="color:#f92672">++</span><span style="color:#a6e22e">i</span>) <span style="color:#a6e22e">cbs</span>.<span style="color:#a6e22e">remove</span>[<span style="color:#a6e22e">i</span>](<span style="color:#a6e22e">ch</span>, <span style="color:#a6e22e">rm</span>);
</span></span><span style="display:flex;"><span>          <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">removeHook</span> <span style="color:#f92672">=</span> (<span style="color:#a6e22e">_b</span> <span style="color:#f92672">=</span> (<span style="color:#a6e22e">_a</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">ch</span> <span style="color:#f92672">===</span> <span style="color:#66d9ef">null</span> <span style="color:#f92672">||</span> <span style="color:#a6e22e">ch</span> <span style="color:#f92672">===</span> <span style="color:#66d9ef">void</span> <span style="color:#ae81ff">0</span> <span style="color:#f92672">?</span> <span style="color:#66d9ef">void</span> <span style="color:#ae81ff">0</span> <span style="color:#f92672">:</span> <span style="color:#a6e22e">ch</span>.<span style="color:#a6e22e">data</span>) <span style="color:#f92672">===</span> <span style="color:#66d9ef">null</span> <span style="color:#f92672">||</span> <span style="color:#a6e22e">_a</span> <span style="color:#f92672">===</span> <span style="color:#66d9ef">void</span> <span style="color:#ae81ff">0</span> <span style="color:#f92672">?</span> <span style="color:#66d9ef">void</span> <span style="color:#ae81ff">0</span> <span style="color:#f92672">:</span> <span style="color:#a6e22e">_a</span>.<span style="color:#a6e22e">hook</span>) <span style="color:#f92672">===</span> <span style="color:#66d9ef">null</span> <span style="color:#f92672">||</span> <span style="color:#a6e22e">_b</span> <span style="color:#f92672">===</span> <span style="color:#66d9ef">void</span> <span style="color:#ae81ff">0</span> <span style="color:#f92672">?</span> <span style="color:#66d9ef">void</span> <span style="color:#ae81ff">0</span> <span style="color:#f92672">:</span> <span style="color:#a6e22e">_b</span>.<span style="color:#a6e22e">remove</span>;
</span></span><span style="display:flex;"><span>          <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">isDef</span>(<span style="color:#a6e22e">removeHook</span>)) {
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">removeHook</span>(<span style="color:#a6e22e">ch</span>, <span style="color:#a6e22e">rm</span>);
</span></span><span style="display:flex;"><span>          } <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">rm</span>();
</span></span><span style="display:flex;"><span>          }
</span></span><span style="display:flex;"><span>        } <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>          <span style="color:#75715e">// Text node
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>          <span style="color:#a6e22e">api</span>.<span style="color:#a6e22e">removeChild</span>(<span style="color:#a6e22e">parentElm</span>, <span style="color:#a6e22e">ch</span>.<span style="color:#a6e22e">elm</span>);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">updateChildren</span>(<span style="color:#a6e22e">parentElm</span>, <span style="color:#a6e22e">oldCh</span>, <span style="color:#a6e22e">newCh</span>, <span style="color:#a6e22e">insertedVnodeQueue</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">oldStartIdx</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">newStartIdx</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">oldEndIdx</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">oldCh</span>.<span style="color:#a6e22e">length</span> <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">oldStartVnode</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">oldCh</span>[<span style="color:#ae81ff">0</span>];
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">oldEndVnode</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">oldCh</span>[<span style="color:#a6e22e">oldEndIdx</span>];
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">newEndIdx</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">newCh</span>.<span style="color:#a6e22e">length</span> <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">newStartVnode</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">newCh</span>[<span style="color:#ae81ff">0</span>];
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">newEndVnode</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">newCh</span>[<span style="color:#a6e22e">newEndIdx</span>];
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">oldKeyToIdx</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">idxInOld</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">elmToMove</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">before</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">while</span> (<span style="color:#a6e22e">oldStartIdx</span> <span style="color:#f92672">&lt;=</span> <span style="color:#a6e22e">oldEndIdx</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#a6e22e">newStartIdx</span> <span style="color:#f92672">&lt;=</span> <span style="color:#a6e22e">newEndIdx</span>) {
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">oldStartVnode</span> <span style="color:#f92672">==</span> <span style="color:#66d9ef">null</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">oldStartVnode</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">oldCh</span>[<span style="color:#f92672">++</span><span style="color:#a6e22e">oldStartIdx</span>]; <span style="color:#75715e">// Vnode might have been moved left
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>      } <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">oldEndVnode</span> <span style="color:#f92672">==</span> <span style="color:#66d9ef">null</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">oldEndVnode</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">oldCh</span>[<span style="color:#f92672">--</span><span style="color:#a6e22e">oldEndIdx</span>];
</span></span><span style="display:flex;"><span>      } <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">newStartVnode</span> <span style="color:#f92672">==</span> <span style="color:#66d9ef">null</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">newStartVnode</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">newCh</span>[<span style="color:#f92672">++</span><span style="color:#a6e22e">newStartIdx</span>];
</span></span><span style="display:flex;"><span>      } <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">newEndVnode</span> <span style="color:#f92672">==</span> <span style="color:#66d9ef">null</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">newEndVnode</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">newCh</span>[<span style="color:#f92672">--</span><span style="color:#a6e22e">newEndIdx</span>];
</span></span><span style="display:flex;"><span>      } <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">sameVnode</span>(<span style="color:#a6e22e">oldStartVnode</span>, <span style="color:#a6e22e">newStartVnode</span>)) {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">patchVnode</span>(<span style="color:#a6e22e">oldStartVnode</span>, <span style="color:#a6e22e">newStartVnode</span>, <span style="color:#a6e22e">insertedVnodeQueue</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">oldStartVnode</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">oldCh</span>[<span style="color:#f92672">++</span><span style="color:#a6e22e">oldStartIdx</span>];
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">newStartVnode</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">newCh</span>[<span style="color:#f92672">++</span><span style="color:#a6e22e">newStartIdx</span>];
</span></span><span style="display:flex;"><span>      } <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">sameVnode</span>(<span style="color:#a6e22e">oldEndVnode</span>, <span style="color:#a6e22e">newEndVnode</span>)) {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">patchVnode</span>(<span style="color:#a6e22e">oldEndVnode</span>, <span style="color:#a6e22e">newEndVnode</span>, <span style="color:#a6e22e">insertedVnodeQueue</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">oldEndVnode</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">oldCh</span>[<span style="color:#f92672">--</span><span style="color:#a6e22e">oldEndIdx</span>];
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">newEndVnode</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">newCh</span>[<span style="color:#f92672">--</span><span style="color:#a6e22e">newEndIdx</span>];
</span></span><span style="display:flex;"><span>      } <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">sameVnode</span>(<span style="color:#a6e22e">oldStartVnode</span>, <span style="color:#a6e22e">newEndVnode</span>)) {
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// Vnode moved right
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#a6e22e">patchVnode</span>(<span style="color:#a6e22e">oldStartVnode</span>, <span style="color:#a6e22e">newEndVnode</span>, <span style="color:#a6e22e">insertedVnodeQueue</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">api</span>.<span style="color:#a6e22e">insertBefore</span>(<span style="color:#a6e22e">parentElm</span>, <span style="color:#a6e22e">oldStartVnode</span>.<span style="color:#a6e22e">elm</span>, <span style="color:#a6e22e">api</span>.<span style="color:#a6e22e">nextSibling</span>(<span style="color:#a6e22e">oldEndVnode</span>.<span style="color:#a6e22e">elm</span>));
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">oldStartVnode</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">oldCh</span>[<span style="color:#f92672">++</span><span style="color:#a6e22e">oldStartIdx</span>];
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">newEndVnode</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">newCh</span>[<span style="color:#f92672">--</span><span style="color:#a6e22e">newEndIdx</span>];
</span></span><span style="display:flex;"><span>      } <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">sameVnode</span>(<span style="color:#a6e22e">oldEndVnode</span>, <span style="color:#a6e22e">newStartVnode</span>)) {
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// Vnode moved left
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#a6e22e">patchVnode</span>(<span style="color:#a6e22e">oldEndVnode</span>, <span style="color:#a6e22e">newStartVnode</span>, <span style="color:#a6e22e">insertedVnodeQueue</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">api</span>.<span style="color:#a6e22e">insertBefore</span>(<span style="color:#a6e22e">parentElm</span>, <span style="color:#a6e22e">oldEndVnode</span>.<span style="color:#a6e22e">elm</span>, <span style="color:#a6e22e">oldStartVnode</span>.<span style="color:#a6e22e">elm</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">oldEndVnode</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">oldCh</span>[<span style="color:#f92672">--</span><span style="color:#a6e22e">oldEndIdx</span>];
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">newStartVnode</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">newCh</span>[<span style="color:#f92672">++</span><span style="color:#a6e22e">newStartIdx</span>];
</span></span><span style="display:flex;"><span>      } <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">oldKeyToIdx</span> <span style="color:#f92672">===</span> <span style="color:#66d9ef">undefined</span>) {
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">oldKeyToIdx</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">createKeyToOldIdx</span>(<span style="color:#a6e22e">oldCh</span>, <span style="color:#a6e22e">oldStartIdx</span>, <span style="color:#a6e22e">oldEndIdx</span>);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">idxInOld</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">oldKeyToIdx</span>[<span style="color:#a6e22e">newStartVnode</span>.<span style="color:#a6e22e">key</span>];
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">isUndef</span>(<span style="color:#a6e22e">idxInOld</span>)) {
</span></span><span style="display:flex;"><span>          <span style="color:#75715e">// New element
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>          <span style="color:#a6e22e">api</span>.<span style="color:#a6e22e">insertBefore</span>(<span style="color:#a6e22e">parentElm</span>, <span style="color:#a6e22e">createElm</span>(<span style="color:#a6e22e">newStartVnode</span>, <span style="color:#a6e22e">insertedVnodeQueue</span>), <span style="color:#a6e22e">oldStartVnode</span>.<span style="color:#a6e22e">elm</span>);
</span></span><span style="display:flex;"><span>        } <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">elmToMove</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">oldCh</span>[<span style="color:#a6e22e">idxInOld</span>];
</span></span><span style="display:flex;"><span>          <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">elmToMove</span>.<span style="color:#a6e22e">sel</span> <span style="color:#f92672">!==</span> <span style="color:#a6e22e">newStartVnode</span>.<span style="color:#a6e22e">sel</span>) {
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">api</span>.<span style="color:#a6e22e">insertBefore</span>(<span style="color:#a6e22e">parentElm</span>, <span style="color:#a6e22e">createElm</span>(<span style="color:#a6e22e">newStartVnode</span>, <span style="color:#a6e22e">insertedVnodeQueue</span>), <span style="color:#a6e22e">oldStartVnode</span>.<span style="color:#a6e22e">elm</span>);
</span></span><span style="display:flex;"><span>          } <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">patchVnode</span>(<span style="color:#a6e22e">elmToMove</span>, <span style="color:#a6e22e">newStartVnode</span>, <span style="color:#a6e22e">insertedVnodeQueue</span>);
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">oldCh</span>[<span style="color:#a6e22e">idxInOld</span>] <span style="color:#f92672">=</span> <span style="color:#66d9ef">undefined</span>;
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">api</span>.<span style="color:#a6e22e">insertBefore</span>(<span style="color:#a6e22e">parentElm</span>, <span style="color:#a6e22e">elmToMove</span>.<span style="color:#a6e22e">elm</span>, <span style="color:#a6e22e">oldStartVnode</span>.<span style="color:#a6e22e">elm</span>);
</span></span><span style="display:flex;"><span>          }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">newStartVnode</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">newCh</span>[<span style="color:#f92672">++</span><span style="color:#a6e22e">newStartIdx</span>];
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">oldStartIdx</span> <span style="color:#f92672">&lt;=</span> <span style="color:#a6e22e">oldEndIdx</span> <span style="color:#f92672">||</span> <span style="color:#a6e22e">newStartIdx</span> <span style="color:#f92672">&lt;=</span> <span style="color:#a6e22e">newEndIdx</span>) {
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">oldStartIdx</span> <span style="color:#f92672">&gt;</span> <span style="color:#a6e22e">oldEndIdx</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">before</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">newCh</span>[<span style="color:#a6e22e">newEndIdx</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>] <span style="color:#f92672">==</span> <span style="color:#66d9ef">null</span> <span style="color:#f92672">?</span> <span style="color:#66d9ef">null</span> <span style="color:#f92672">:</span> <span style="color:#a6e22e">newCh</span>[<span style="color:#a6e22e">newEndIdx</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>].<span style="color:#a6e22e">elm</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">addVnodes</span>(<span style="color:#a6e22e">parentElm</span>, <span style="color:#a6e22e">before</span>, <span style="color:#a6e22e">newCh</span>, <span style="color:#a6e22e">newStartIdx</span>, <span style="color:#a6e22e">newEndIdx</span>, <span style="color:#a6e22e">insertedVnodeQueue</span>);
</span></span><span style="display:flex;"><span>      } <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">removeVnodes</span>(<span style="color:#a6e22e">parentElm</span>, <span style="color:#a6e22e">oldCh</span>, <span style="color:#a6e22e">oldStartIdx</span>, <span style="color:#a6e22e">oldEndIdx</span>);
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">patchVnode</span>(<span style="color:#a6e22e">oldVnode</span>, <span style="color:#a6e22e">vnode</span>, <span style="color:#a6e22e">insertedVnodeQueue</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">_a</span>, <span style="color:#a6e22e">_b</span>, <span style="color:#a6e22e">_c</span>, <span style="color:#a6e22e">_d</span>, <span style="color:#a6e22e">_e</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">hook</span> <span style="color:#f92672">=</span> (<span style="color:#a6e22e">_a</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">vnode</span>.<span style="color:#a6e22e">data</span>) <span style="color:#f92672">===</span> <span style="color:#66d9ef">null</span> <span style="color:#f92672">||</span> <span style="color:#a6e22e">_a</span> <span style="color:#f92672">===</span> <span style="color:#66d9ef">void</span> <span style="color:#ae81ff">0</span> <span style="color:#f92672">?</span> <span style="color:#66d9ef">void</span> <span style="color:#ae81ff">0</span> <span style="color:#f92672">:</span> <span style="color:#a6e22e">_a</span>.<span style="color:#a6e22e">hook</span>;
</span></span><span style="display:flex;"><span>    (<span style="color:#a6e22e">_b</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">hook</span> <span style="color:#f92672">===</span> <span style="color:#66d9ef">null</span> <span style="color:#f92672">||</span> <span style="color:#a6e22e">hook</span> <span style="color:#f92672">===</span> <span style="color:#66d9ef">void</span> <span style="color:#ae81ff">0</span> <span style="color:#f92672">?</span> <span style="color:#66d9ef">void</span> <span style="color:#ae81ff">0</span> <span style="color:#f92672">:</span> <span style="color:#a6e22e">hook</span>.<span style="color:#a6e22e">prepatch</span>) <span style="color:#f92672">===</span> <span style="color:#66d9ef">null</span> <span style="color:#f92672">||</span> <span style="color:#a6e22e">_b</span> <span style="color:#f92672">===</span> <span style="color:#66d9ef">void</span> <span style="color:#ae81ff">0</span> <span style="color:#f92672">?</span> <span style="color:#66d9ef">void</span> <span style="color:#ae81ff">0</span> <span style="color:#f92672">:</span> <span style="color:#a6e22e">_b</span>.<span style="color:#a6e22e">call</span>(<span style="color:#a6e22e">hook</span>, <span style="color:#a6e22e">oldVnode</span>, <span style="color:#a6e22e">vnode</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">elm</span> <span style="color:#f92672">=</span> (<span style="color:#a6e22e">vnode</span>.<span style="color:#a6e22e">elm</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">oldVnode</span>.<span style="color:#a6e22e">elm</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">oldCh</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">oldVnode</span>.<span style="color:#a6e22e">children</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">ch</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">vnode</span>.<span style="color:#a6e22e">children</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">oldVnode</span> <span style="color:#f92672">===</span> <span style="color:#a6e22e">vnode</span>) <span style="color:#66d9ef">return</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">vnode</span>.<span style="color:#a6e22e">data</span> <span style="color:#f92672">!==</span> <span style="color:#66d9ef">undefined</span>) {
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">let</span> <span style="color:#a6e22e">i</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; <span style="color:#a6e22e">i</span> <span style="color:#f92672">&lt;</span> <span style="color:#a6e22e">cbs</span>.<span style="color:#a6e22e">update</span>.<span style="color:#a6e22e">length</span>; <span style="color:#f92672">++</span><span style="color:#a6e22e">i</span>) <span style="color:#a6e22e">cbs</span>.<span style="color:#a6e22e">update</span>[<span style="color:#a6e22e">i</span>](<span style="color:#a6e22e">oldVnode</span>, <span style="color:#a6e22e">vnode</span>);
</span></span><span style="display:flex;"><span>      (<span style="color:#a6e22e">_d</span> <span style="color:#f92672">=</span> (<span style="color:#a6e22e">_c</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">vnode</span>.<span style="color:#a6e22e">data</span>.<span style="color:#a6e22e">hook</span>) <span style="color:#f92672">===</span> <span style="color:#66d9ef">null</span> <span style="color:#f92672">||</span> <span style="color:#a6e22e">_c</span> <span style="color:#f92672">===</span> <span style="color:#66d9ef">void</span> <span style="color:#ae81ff">0</span> <span style="color:#f92672">?</span> <span style="color:#66d9ef">void</span> <span style="color:#ae81ff">0</span> <span style="color:#f92672">:</span> <span style="color:#a6e22e">_c</span>.<span style="color:#a6e22e">update</span>) <span style="color:#f92672">===</span> <span style="color:#66d9ef">null</span> <span style="color:#f92672">||</span> <span style="color:#a6e22e">_d</span> <span style="color:#f92672">===</span> <span style="color:#66d9ef">void</span> <span style="color:#ae81ff">0</span> <span style="color:#f92672">?</span> <span style="color:#66d9ef">void</span> <span style="color:#ae81ff">0</span> <span style="color:#f92672">:</span> <span style="color:#a6e22e">_d</span>.<span style="color:#a6e22e">call</span>(<span style="color:#a6e22e">_c</span>, <span style="color:#a6e22e">oldVnode</span>, <span style="color:#a6e22e">vnode</span>);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">isUndef</span>(<span style="color:#a6e22e">vnode</span>.<span style="color:#a6e22e">text</span>)) {
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">isDef</span>(<span style="color:#a6e22e">oldCh</span>) <span style="color:#f92672">&amp;&amp;</span> <span style="color:#a6e22e">isDef</span>(<span style="color:#a6e22e">ch</span>)) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">oldCh</span> <span style="color:#f92672">!==</span> <span style="color:#a6e22e">ch</span>) <span style="color:#a6e22e">updateChildren</span>(<span style="color:#a6e22e">elm</span>, <span style="color:#a6e22e">oldCh</span>, <span style="color:#a6e22e">ch</span>, <span style="color:#a6e22e">insertedVnodeQueue</span>);
</span></span><span style="display:flex;"><span>      } <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">isDef</span>(<span style="color:#a6e22e">ch</span>)) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">isDef</span>(<span style="color:#a6e22e">oldVnode</span>.<span style="color:#a6e22e">text</span>)) <span style="color:#a6e22e">api</span>.<span style="color:#a6e22e">setTextContent</span>(<span style="color:#a6e22e">elm</span>, <span style="color:#e6db74">&#34;&#34;</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">addVnodes</span>(<span style="color:#a6e22e">elm</span>, <span style="color:#66d9ef">null</span>, <span style="color:#a6e22e">ch</span>, <span style="color:#ae81ff">0</span>, <span style="color:#a6e22e">ch</span>.<span style="color:#a6e22e">length</span> <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>, <span style="color:#a6e22e">insertedVnodeQueue</span>);
</span></span><span style="display:flex;"><span>      } <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">isDef</span>(<span style="color:#a6e22e">oldCh</span>)) {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">removeVnodes</span>(<span style="color:#a6e22e">elm</span>, <span style="color:#a6e22e">oldCh</span>, <span style="color:#ae81ff">0</span>, <span style="color:#a6e22e">oldCh</span>.<span style="color:#a6e22e">length</span> <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>);
</span></span><span style="display:flex;"><span>      } <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">isDef</span>(<span style="color:#a6e22e">oldVnode</span>.<span style="color:#a6e22e">text</span>)) {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">api</span>.<span style="color:#a6e22e">setTextContent</span>(<span style="color:#a6e22e">elm</span>, <span style="color:#e6db74">&#34;&#34;</span>);
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>    } <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">oldVnode</span>.<span style="color:#a6e22e">text</span> <span style="color:#f92672">!==</span> <span style="color:#a6e22e">vnode</span>.<span style="color:#a6e22e">text</span>) {
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">isDef</span>(<span style="color:#a6e22e">oldCh</span>)) {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">removeVnodes</span>(<span style="color:#a6e22e">elm</span>, <span style="color:#a6e22e">oldCh</span>, <span style="color:#ae81ff">0</span>, <span style="color:#a6e22e">oldCh</span>.<span style="color:#a6e22e">length</span> <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>);
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">api</span>.<span style="color:#a6e22e">setTextContent</span>(<span style="color:#a6e22e">elm</span>, <span style="color:#a6e22e">vnode</span>.<span style="color:#a6e22e">text</span>);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    (<span style="color:#a6e22e">_e</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">hook</span> <span style="color:#f92672">===</span> <span style="color:#66d9ef">null</span> <span style="color:#f92672">||</span> <span style="color:#a6e22e">hook</span> <span style="color:#f92672">===</span> <span style="color:#66d9ef">void</span> <span style="color:#ae81ff">0</span> <span style="color:#f92672">?</span> <span style="color:#66d9ef">void</span> <span style="color:#ae81ff">0</span> <span style="color:#f92672">:</span> <span style="color:#a6e22e">hook</span>.<span style="color:#a6e22e">postpatch</span>) <span style="color:#f92672">===</span> <span style="color:#66d9ef">null</span> <span style="color:#f92672">||</span> <span style="color:#a6e22e">_e</span> <span style="color:#f92672">===</span> <span style="color:#66d9ef">void</span> <span style="color:#ae81ff">0</span> <span style="color:#f92672">?</span> <span style="color:#66d9ef">void</span> <span style="color:#ae81ff">0</span> <span style="color:#f92672">:</span> <span style="color:#a6e22e">_e</span>.<span style="color:#a6e22e">call</span>(<span style="color:#a6e22e">hook</span>, <span style="color:#a6e22e">oldVnode</span>, <span style="color:#a6e22e">vnode</span>);
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">patch</span>(<span style="color:#a6e22e">oldVnode</span>, <span style="color:#a6e22e">vnode</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">i</span>, <span style="color:#a6e22e">elm</span>, <span style="color:#a6e22e">parent</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">insertedVnodeQueue</span> <span style="color:#f92672">=</span> [];
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> (<span style="color:#a6e22e">i</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; <span style="color:#a6e22e">i</span> <span style="color:#f92672">&lt;</span> <span style="color:#a6e22e">cbs</span>.<span style="color:#a6e22e">pre</span>.<span style="color:#a6e22e">length</span>; <span style="color:#f92672">++</span><span style="color:#a6e22e">i</span>) <span style="color:#a6e22e">cbs</span>.<span style="color:#a6e22e">pre</span>[<span style="color:#a6e22e">i</span>]();
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (<span style="color:#f92672">!</span><span style="color:#a6e22e">isVnode</span>(<span style="color:#a6e22e">oldVnode</span>)) {
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">oldVnode</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">emptyNodeAt</span>(<span style="color:#a6e22e">oldVnode</span>);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">sameVnode</span>(<span style="color:#a6e22e">oldVnode</span>, <span style="color:#a6e22e">vnode</span>)) {
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">patchVnode</span>(<span style="color:#a6e22e">oldVnode</span>, <span style="color:#a6e22e">vnode</span>, <span style="color:#a6e22e">insertedVnodeQueue</span>);
</span></span><span style="display:flex;"><span>    } <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">elm</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">oldVnode</span>.<span style="color:#a6e22e">elm</span>;
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">parent</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">api</span>.<span style="color:#a6e22e">parentNode</span>(<span style="color:#a6e22e">elm</span>);
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">createElm</span>(<span style="color:#a6e22e">vnode</span>, <span style="color:#a6e22e">insertedVnodeQueue</span>);
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">parent</span> <span style="color:#f92672">!==</span> <span style="color:#66d9ef">null</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">api</span>.<span style="color:#a6e22e">insertBefore</span>(<span style="color:#a6e22e">parent</span>, <span style="color:#a6e22e">vnode</span>.<span style="color:#a6e22e">elm</span>, <span style="color:#a6e22e">api</span>.<span style="color:#a6e22e">nextSibling</span>(<span style="color:#a6e22e">elm</span>));
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">removeVnodes</span>(<span style="color:#a6e22e">parent</span>, [<span style="color:#a6e22e">oldVnode</span>], <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>);
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> (<span style="color:#a6e22e">i</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; <span style="color:#a6e22e">i</span> <span style="color:#f92672">&lt;</span> <span style="color:#a6e22e">insertedVnodeQueue</span>.<span style="color:#a6e22e">length</span>; <span style="color:#f92672">++</span><span style="color:#a6e22e">i</span>) {
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">insertedVnodeQueue</span>[<span style="color:#a6e22e">i</span>].<span style="color:#a6e22e">data</span>.<span style="color:#a6e22e">hook</span>.<span style="color:#a6e22e">insert</span>(<span style="color:#a6e22e">insertedVnodeQueue</span>[<span style="color:#a6e22e">i</span>]);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> (<span style="color:#a6e22e">i</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; <span style="color:#a6e22e">i</span> <span style="color:#f92672">&lt;</span> <span style="color:#a6e22e">cbs</span>.<span style="color:#a6e22e">post</span>.<span style="color:#a6e22e">length</span>; <span style="color:#f92672">++</span><span style="color:#a6e22e">i</span>) <span style="color:#a6e22e">cbs</span>.<span style="color:#a6e22e">post</span>[<span style="color:#a6e22e">i</span>]();
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">vnode</span>;
</span></span><span style="display:flex;"><span>  };
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h2 id="使用">使用</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#66d9ef">import</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">init</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">h</span>,
</span></span><span style="display:flex;"><span>} <span style="color:#a6e22e">from</span> <span style="color:#e6db74">&#34;snabbdom&#34;</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">patch</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">init</span>([]);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">container</span> <span style="color:#f92672">=</span> document.<span style="color:#a6e22e">getElementById</span>(<span style="color:#e6db74">&#34;container&#34;</span>);
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">vnode1</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">h</span>(<span style="color:#e6db74">&#34;div&#34;</span>, { <span style="color:#a6e22e">style</span><span style="color:#f92672">:</span> { <span style="color:#a6e22e">color</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;#000&#34;</span> } }, [
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">h</span>(<span style="color:#e6db74">&#34;h1&#34;</span>, <span style="color:#e6db74">&#34;Headline&#34;</span>),
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">h</span>(<span style="color:#e6db74">&#34;p&#34;</span>, <span style="color:#e6db74">&#34;A paragraph&#34;</span>),
</span></span><span style="display:flex;"><span>]);
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">patch</span>(<span style="color:#a6e22e">container</span>, <span style="color:#a6e22e">vnode1</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">vnode2</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">h</span>(<span style="color:#e6db74">&#34;ul&#34;</span>, { }, [
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">h</span>(<span style="color:#e6db74">&#34;li&#34;</span>, <span style="color:#e6db74">&#34;red&#34;</span>),
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">h</span>(<span style="color:#e6db74">&#34;li&#34;</span>, <span style="color:#e6db74">&#34;green&#34;</span>),
</span></span><span style="display:flex;"><span>]);
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">patch</span>(<span style="color:#a6e22e">vnode1</span>, <span style="color:#a6e22e">vnode2</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// 更新了第二个li的值
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">vnode3</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">h</span>(<span style="color:#e6db74">&#34;ul&#34;</span>, { }, [
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">h</span>(<span style="color:#e6db74">&#34;li&#34;</span>, <span style="color:#e6db74">&#34;red&#34;</span>),
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">h</span>(<span style="color:#e6db74">&#34;li&#34;</span>, <span style="color:#e6db74">&#34;blue&#34;</span>),
</span></span><span style="display:flex;"><span>]);
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">patch</span>(<span style="color:#a6e22e">vnode2</span>, <span style="color:#a6e22e">vnode3</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">//更新第二个li的值，并且添加了一个li
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">vnode4</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">h</span>(<span style="color:#e6db74">&#34;ul&#34;</span>, { }, [
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">h</span>(<span style="color:#e6db74">&#34;li&#34;</span>, <span style="color:#e6db74">&#34;red&#34;</span>),
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">h</span>(<span style="color:#e6db74">&#34;li&#34;</span>, <span style="color:#e6db74">&#34;blue&#34;</span>),
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">h</span>(<span style="color:#e6db74">&#34;li&#34;</span>, <span style="color:#e6db74">&#34;yellow&#34;</span>),
</span></span><span style="display:flex;"><span>]);
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">patch</span>(<span style="color:#a6e22e">vnode3</span>, <span style="color:#a6e22e">vnode4</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">//删除子节点
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">vnode5</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">h</span>(<span style="color:#e6db74">&#34;ul&#34;</span>, { }, []);
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">patch</span>(<span style="color:#a6e22e">vnode4</span>, <span style="color:#a6e22e">vnode5</span>);
</span></span></code></pre></div><h2 id="more">More</h2>
<p>snabbdom<br>
<a href="https://github.com/snabbdom/snabbdom">https://github.com/snabbdom/snabbdom</a></p>
</div>
    </div>

        </div></body>
</html>
